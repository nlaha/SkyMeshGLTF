
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyffi.formats.cgf &#8212; PyFFI 2.2.4.dev4 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PyFFI 2.2.4.dev4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyffi.formats.cgf</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyffi.formats.cgf</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:mod:`pyffi.formats.cgf` --- Crytek (.cgf and .cga)</span>
<span class="sd">===================================================</span>

<span class="sd">Implementation</span>
<span class="sd">--------------</span>

<span class="sd">.. autoclass:: CgfFormat</span>
<span class="sd">   :show-inheritance:</span>
<span class="sd">   :members:</span>

<span class="sd">Regression tests</span>
<span class="sd">----------------</span>

<span class="sd">Read a CGF file</span>
<span class="sd">^^^^^^^^^^^^^^^</span>

<span class="sd">&gt;&gt;&gt; # get file version and file type, and read cgf file</span>
<span class="sd">&gt;&gt;&gt; from os.path import dirname</span>
<span class="sd">&gt;&gt;&gt; dirpath = __file__</span>
<span class="sd">&gt;&gt;&gt; for i in range(4): #recurse up to root repo dir</span>
<span class="sd">...     dirpath = dirname(dirpath)</span>
<span class="sd">&gt;&gt;&gt; repo_root = dirpath</span>
<span class="sd">&gt;&gt;&gt; format_root = os.path.join(repo_root, &#39;tests&#39;, &#39;formats&#39;, &#39;cgf&#39;)</span>
<span class="sd">&gt;&gt;&gt; stream = open(os.path.join(format_root, &#39;test.cgf&#39;), &#39;rb&#39;)</span>
<span class="sd">&gt;&gt;&gt; data = CgfFormat.Data()</span>
<span class="sd">&gt;&gt;&gt; # read chunk table only</span>
<span class="sd">&gt;&gt;&gt; data.inspect(stream)</span>
<span class="sd">&gt;&gt;&gt; # check chunk types</span>
<span class="sd">&gt;&gt;&gt; list(chunktype.__name__ for chunktype in data.chunk_table.get_chunk_types())</span>
<span class="sd">[&#39;SourceInfoChunk&#39;, &#39;TimingChunk&#39;]</span>
<span class="sd">&gt;&gt;&gt; data.chunks # no chunks yet</span>
<span class="sd">[]</span>
<span class="sd">&gt;&gt;&gt; # read full file</span>
<span class="sd">&gt;&gt;&gt; data.read(stream)</span>
<span class="sd">&gt;&gt;&gt; # get all chunks</span>
<span class="sd">&gt;&gt;&gt; for chunk in data.chunks:</span>
<span class="sd">...     print(chunk) # doctest: +ELLIPSIS</span>
<span class="sd">&lt;class &#39;...SourceInfoChunk&#39;&gt; instance at ...</span>
<span class="sd">* source_file : &lt;None&gt;</span>
<span class="sd">* date : Fri Sep 28 22:40:44 2007</span>
<span class="sd">* author : blender@BLENDER</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">&lt;class &#39;...TimingChunk&#39;&gt; instance at ...</span>
<span class="sd">* secs_per_tick : 0.0002083333...</span>
<span class="sd">* ticks_per_frame : 160</span>
<span class="sd">* global_range :</span>
<span class="sd">    &lt;class &#39;...RangeEntity&#39;&gt; instance at ...</span>
<span class="sd">    * name : GlobalRange</span>
<span class="sd">    * start : 0</span>
<span class="sd">    * end : 100</span>
<span class="sd">* num_sub_ranges : 0</span>
<span class="sd">&lt;BLANKLINE&gt;</span>

<span class="sd">Parse all CGF files in a directory tree</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">&gt;&gt;&gt; for stream, data in CgfFormat.walkData(format_root):</span>
<span class="sd">...     try:</span>
<span class="sd">...         # the replace call makes the doctest also pass on windows</span>
<span class="sd">...         os_path = stream.name</span>
<span class="sd">...         split = (os_path.split(os.sep))[-4:]</span>
<span class="sd">...         rejoin = os.path.join(*split).replace(os.sep, &quot;/&quot;)</span>
<span class="sd">...         print(&quot;reading %s&quot; % rejoin)</span>
<span class="sd">...         data.read(stream)</span>
<span class="sd">...     except Exception:</span>
<span class="sd">...         print(&quot;Warning: read failed due corrupt file, corrupt format description, or bug.&quot;)</span>
<span class="sd">...     print(len(data.chunks))</span>
<span class="sd">...     # do something with the chunks</span>
<span class="sd">...     for chunk in data.chunks:</span>
<span class="sd">...         chunk.apply_scale(2.0)</span>
<span class="sd">reading tests/formats/cgf/invalid.cgf</span>
<span class="sd">Warning: read failed due corrupt file, corrupt format description, or bug.</span>
<span class="sd">0</span>
<span class="sd">reading tests/formats/cgf/monkey.cgf</span>
<span class="sd">14</span>
<span class="sd">reading tests/formats/cgf/test.cgf</span>
<span class="sd">2</span>
<span class="sd">reading tests/formats/cgf/vcols.cgf</span>
<span class="sd">6</span>

<span class="sd">Create a CGF file from scratch</span>
<span class="sd">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="sd">&gt;&gt;&gt; from pyffi.formats.cgf import CgfFormat</span>
<span class="sd">&gt;&gt;&gt; node1 = CgfFormat.NodeChunk()</span>
<span class="sd">&gt;&gt;&gt; node1.name = &quot;hello&quot;</span>
<span class="sd">&gt;&gt;&gt; node2 = CgfFormat.NodeChunk()</span>
<span class="sd">&gt;&gt;&gt; node1.num_children = 1</span>
<span class="sd">&gt;&gt;&gt; node1.children.update_size()</span>
<span class="sd">&gt;&gt;&gt; node1.children[0] = node2</span>
<span class="sd">&gt;&gt;&gt; node2.name = &quot;world&quot;</span>
<span class="sd">&gt;&gt;&gt; from tempfile import TemporaryFile</span>
<span class="sd">&gt;&gt;&gt; stream = TemporaryFile()</span>
<span class="sd">&gt;&gt;&gt; data = CgfFormat.Data() # default is far cry</span>
<span class="sd">&gt;&gt;&gt; data.chunks = [node1, node2]</span>
<span class="sd">&gt;&gt;&gt; # note: write returns number of padding bytes</span>
<span class="sd">&gt;&gt;&gt; data.write(stream)</span>
<span class="sd">0</span>
<span class="sd">&gt;&gt;&gt; # py3k returns 0 on seek; this hack removes return code from doctest</span>
<span class="sd">&gt;&gt;&gt; if stream.seek(0): pass</span>
<span class="sd">&gt;&gt;&gt; data.inspect_version_only(stream)</span>
<span class="sd">&gt;&gt;&gt; hex(data.header.version)</span>
<span class="sd">&#39;0x744&#39;</span>
<span class="sd">&gt;&gt;&gt; data.read(stream)</span>
<span class="sd">&gt;&gt;&gt; # get all chunks</span>
<span class="sd">&gt;&gt;&gt; for chunk in data.chunks:</span>
<span class="sd">...     print(chunk) # doctest: +ELLIPSIS +REPORT_NDIFF</span>
<span class="sd">&lt;class &#39;pyffi.formats.cgf.NodeChunk&#39;&gt; instance at 0x...</span>
<span class="sd">* name : hello</span>
<span class="sd">* object : None</span>
<span class="sd">* parent : None</span>
<span class="sd">* num_children : 1</span>
<span class="sd">* material : None</span>
<span class="sd">* is_group_head : False</span>
<span class="sd">* is_group_member : False</span>
<span class="sd">* reserved_1 :</span>
<span class="sd">    &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at 0x...</span>
<span class="sd">    0: 0</span>
<span class="sd">    1: 0</span>
<span class="sd">* transform :</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">* pos : [  0.000  0.000  0.000 ]</span>
<span class="sd">* rot :</span>
<span class="sd">    &lt;class &#39;pyffi.formats.cgf.Quat&#39;&gt; instance at 0x...</span>
<span class="sd">    * x : 0.0</span>
<span class="sd">    * y : 0.0</span>
<span class="sd">    * z : 0.0</span>
<span class="sd">    * w : 0.0</span>
<span class="sd">* scl : [  0.000  0.000  0.000 ]</span>
<span class="sd">* pos_ctrl : None</span>
<span class="sd">* rot_ctrl : None</span>
<span class="sd">* scl_ctrl : None</span>
<span class="sd">* property_string : &lt;None&gt;</span>
<span class="sd">* children :</span>
<span class="sd">    &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at 0x...</span>
<span class="sd">    0: &lt;class &#39;pyffi.formats.cgf.NodeChunk&#39;&gt; instance at 0x...</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">&lt;class &#39;pyffi.formats.cgf.NodeChunk&#39;&gt; instance at 0x...</span>
<span class="sd">* name : world</span>
<span class="sd">* object : None</span>
<span class="sd">* parent : None</span>
<span class="sd">* num_children : 0</span>
<span class="sd">* material : None</span>
<span class="sd">* is_group_head : False</span>
<span class="sd">* is_group_member : False</span>
<span class="sd">* reserved_1 :</span>
<span class="sd">    &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at 0x...</span>
<span class="sd">    0: 0</span>
<span class="sd">    1: 0</span>
<span class="sd">* transform :</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">    [  0.000  0.000  0.000  0.000 ]</span>
<span class="sd">* pos : [  0.000  0.000  0.000 ]</span>
<span class="sd">* rot :</span>
<span class="sd">    &lt;class &#39;pyffi.formats.cgf.Quat&#39;&gt; instance at 0x...</span>
<span class="sd">    * x : 0.0</span>
<span class="sd">    * y : 0.0</span>
<span class="sd">    * z : 0.0</span>
<span class="sd">    * w : 0.0</span>
<span class="sd">* scl : [  0.000  0.000  0.000 ]</span>
<span class="sd">* pos_ctrl : None</span>
<span class="sd">* rot_ctrl : None</span>
<span class="sd">* scl_ctrl : None</span>
<span class="sd">* property_string : &lt;None&gt;</span>
<span class="sd">* children : &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at 0x...</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># ***** BEGIN LICENSE BLOCK *****</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2007-2012, Python File Format Interface</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions</span>
<span class="c1"># are met:</span>
<span class="c1">#</span>
<span class="c1">#    * Redistributions of source code must retain the above copyright</span>
<span class="c1">#      notice, this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1">#    * Redistributions in binary form must reproduce the above</span>
<span class="c1">#      copyright notice, this list of conditions and the following</span>
<span class="c1">#      disclaimer in the documentation and/or other materials provided</span>
<span class="c1">#      with the distribution.</span>
<span class="c1">#</span>
<span class="c1">#    * Neither the name of the Python File Format Interface</span>
<span class="c1">#      project nor the names of its contributors may be used to endorse</span>
<span class="c1">#      or promote products derived from this software without specific</span>
<span class="c1">#      prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<span class="c1"># FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span>
<span class="c1"># COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="c1"># INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<span class="c1"># BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<span class="c1"># LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="c1"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="c1"># LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<span class="c1"># ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c1"># POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">#</span>
<span class="c1"># ***** END LICENSE BLOCK *****</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>



<span class="kn">import</span> <span class="nn">pyffi.object_models.common</span>
<span class="kn">import</span> <span class="nn">pyffi.object_models</span>
<span class="kn">import</span> <span class="nn">pyffi.object_models.xml</span>
<span class="kn">import</span> <span class="nn">pyffi.utils.mathutils</span>
<span class="kn">import</span> <span class="nn">pyffi.utils.tangentspace</span>
<span class="kn">from</span> <span class="nn">pyffi.object_models.xml.basic</span> <span class="kn">import</span> <span class="n">BasicBase</span>
<span class="kn">from</span> <span class="nn">pyffi.utils.graph</span> <span class="kn">import</span> <span class="n">EdgeFilter</span>

<span class="k">class</span> <span class="nc">_MetaCgfFormat</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">MetaFileFormat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass which constructs the chunk map during class creation.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_MetaCgfFormat</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
        
        <span class="c1"># map chunk type integers to chunk type classes</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">CHUNK_MAP</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">ChunkType</span><span class="p">,</span> <span class="n">chunk_name</span><span class="p">),</span>
             <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Chunk&#39;</span> <span class="o">%</span> <span class="n">chunk_name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">chunk_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">_enumkeys</span>
            <span class="k">if</span> <span class="n">chunk_name</span> <span class="o">!=</span> <span class="s2">&quot;ANY&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CgfFormat"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat">[docs]</a><span class="k">class</span> <span class="nc">CgfFormat</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="n">FileFormat</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">_MetaCgfFormat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Stores all information about the cgf file format.&quot;&quot;&quot;</span>
    <span class="n">xml_file_name</span> <span class="o">=</span> <span class="s1">&#39;cgf.xml&#39;</span>
    <span class="c1"># where to look for cgf.xml and in what order: CGFXMLPATH env var,</span>
    <span class="c1"># or module directory</span>
    <span class="n">xml_file_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;CGFXMLPATH&#39;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)]</span>
    <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.0001</span> <span class="c1"># used for comparing floats</span>
    <span class="c1"># regular expression for file name extension matching on cgf files</span>
    <span class="n">RE_FILENAME</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^.*\.(cgf|cga|chr|caf)$&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

    <span class="c1"># version and user version for far cry</span>
    <span class="n">VER_FARCRY</span> <span class="o">=</span> <span class="mh">0x744</span>
    <span class="n">UVER_FARCRY</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># version and user version for crysis</span>
    <span class="n">VER_CRYSIS</span> <span class="o">=</span> <span class="mh">0x744</span>
    <span class="n">UVER_CRYSIS</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># basic types</span>
    <span class="nb">int</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Int</span>
    <span class="n">uint</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">UInt</span>
    <span class="n">byte</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Byte</span>
    <span class="n">ubyte</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">UByte</span>
    <span class="n">short</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Short</span>
    <span class="n">ushort</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">UShort</span>
    <span class="n">char</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Char</span>
    <span class="nb">float</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Float</span>
    <span class="nb">bool</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">Bool</span>
    <span class="n">String</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ZString</span>
    <span class="n">SizedString</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">SizedString</span>

     <span class="c1"># implementation of cgf-specific basic types</span>

<div class="viewcode-block" id="CgfFormat.String16"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.String16">[docs]</a>    <span class="k">class</span> <span class="nc">String16</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FixedString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String of fixed length 16.&quot;&quot;&quot;</span>
        <span class="n">_len</span> <span class="o">=</span> <span class="mi">16</span></div>

<div class="viewcode-block" id="CgfFormat.String32"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.String32">[docs]</a>    <span class="k">class</span> <span class="nc">String32</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FixedString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String of fixed length 32.&quot;&quot;&quot;</span>
        <span class="n">_len</span> <span class="o">=</span> <span class="mi">32</span></div>

<div class="viewcode-block" id="CgfFormat.String64"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.String64">[docs]</a>    <span class="k">class</span> <span class="nc">String64</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FixedString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String of fixed length 64.&quot;&quot;&quot;</span>
        <span class="n">_len</span> <span class="o">=</span> <span class="mi">64</span></div>

<div class="viewcode-block" id="CgfFormat.String128"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.String128">[docs]</a>    <span class="k">class</span> <span class="nc">String128</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FixedString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String of fixed length 128.&quot;&quot;&quot;</span>
        <span class="n">_len</span> <span class="o">=</span> <span class="mi">128</span></div>

<div class="viewcode-block" id="CgfFormat.String256"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.String256">[docs]</a>    <span class="k">class</span> <span class="nc">String256</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FixedString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String of fixed length 256.&quot;&quot;&quot;</span>
        <span class="n">_len</span> <span class="o">=</span> <span class="mi">256</span></div>

<div class="viewcode-block" id="CgfFormat.FileSignature"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature">[docs]</a>    <span class="k">class</span> <span class="nc">FileSignature</span><span class="p">(</span><span class="n">BasicBase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The CryTek file signature with which every</span>
<span class="sd">        cgf file starts.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">FileSignature</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;XXXXXX&#39;</span>

        <span class="k">def</span> <span class="nf">_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Aion&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;NCAion&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;CryTek&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CgfFormat.FileSignature.read"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature.read">[docs]</a>        <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Read signature from stream.</span>

<span class="sd">            :param stream: The stream to read from.</span>
<span class="sd">            :type stream: file</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">gamesig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">signat</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">signat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">gamesig</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;invalid CGF signature: expected </span><span class="si">%s</span><span class="s2"> but got </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">gamesig</span><span class="p">,</span> <span class="n">signat</span><span class="p">))</span></div>

<div class="viewcode-block" id="CgfFormat.FileSignature.write"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature.write">[docs]</a>        <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Write signature to stream.</span>

<span class="sd">            :param stream: The stream to read from.</span>
<span class="sd">            :type stream: file</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="CgfFormat.FileSignature.get_value"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature.get_value">[docs]</a>        <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get signature.</span>

<span class="sd">            :return: The signature.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></div>

<div class="viewcode-block" id="CgfFormat.FileSignature.set_value"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature.set_value">[docs]</a>        <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Not implemented.&quot;&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Cannot set signature value.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.FileSignature.get_size"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature.get_size">[docs]</a>        <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return number of bytes that the signature occupies in a file.</span>

<span class="sd">            :return: Number of bytes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="mi">8</span></div>

<div class="viewcode-block" id="CgfFormat.FileSignature.get_hash"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.FileSignature.get_hash">[docs]</a>        <span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a hash value for the signature.</span>

<span class="sd">            :return: An immutable object that can be used as a hash.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="CgfFormat.Ref"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref">[docs]</a>    <span class="k">class</span> <span class="nc">Ref</span><span class="p">(</span><span class="n">BasicBase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to a chunk, up the hierarchy.&quot;&quot;&quot;</span>
        <span class="n">_is_template</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">_has_links</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">_has_refs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">Ref</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_template</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CgfFormat.Ref.get_value"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.get_value">[docs]</a>        <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get chunk being referred to.</span>

<span class="sd">            :return: The chunk being referred to.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.set_value"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.set_value">[docs]</a>        <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set chunk reference.</span>

<span class="sd">            :param value: The value to assign.</span>
<span class="sd">            :type value: L{CgfFormat.Chunk}</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s1">&#39;expected an instance of </span><span class="si">%s</span><span class="s1"> but got instance of </span><span class="si">%s</span><span class="s1">&#39;</span>
                        <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.read"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.read">[docs]</a>        <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Read chunk index.</span>

<span class="sd">            :param stream: The stream to read from.</span>
<span class="sd">            :type stream: file</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># fix_links will set this field</span>
            <span class="n">block_index</span><span class="p">,</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">_link_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.write"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.write">[docs]</a>        <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Write chunk index.</span>

<span class="sd">            :param stream: The stream to write to.</span>
<span class="sd">            :type stream: file</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
                    <span class="s1">&#39;&lt;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">_block_index_dct</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">]))</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.fix_links"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.fix_links">[docs]</a>        <span class="k">def</span> <span class="nf">fix_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Resolve chunk index into a chunk.</span>

<span class="sd">            :keyword block_dct: Dictionary mapping block index to block.</span>
<span class="sd">            :type block_dct: dict</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pyffi.cgf.data&quot;</span><span class="p">)</span>
            <span class="n">block_index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_link_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># case when there&#39;s no link</span>
            <span class="k">if</span> <span class="n">block_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
            <span class="c1"># other case: look up the link and check the link type</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_block_dct</span><span class="p">[</span><span class="n">block_index</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c1"># make this raise an exception when all reference errors</span>
                <span class="c1"># are sorted out</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;invalid chunk reference (</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">block_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">block_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># crysis often uses index 0 to refer to an invalid index</span>
                    <span class="c1"># so don&#39;t complain on this one</span>
                    <span class="n">block</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># make this raise an exception when all reference errors</span>
                    <span class="c1"># are sorted out</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">expected instance of </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">but got instance of </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">block</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.get_links"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.get_links">[docs]</a>        <span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return the chunk reference.</span>

<span class="sd">            :return: Empty list if no reference, or single item list containing</span>
<span class="sd">                the reference.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.get_refs"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.get_refs">[docs]</a>        <span class="k">def</span> <span class="nf">get_refs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return the chunk reference.</span>

<span class="sd">            :return: Empty list if no reference, or single item list containing</span>
<span class="sd">                the reference.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span></div>

        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># don&#39;t recurse</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> instance at 0x</span><span class="si">%08X</span><span class="s1">&#39;</span>\
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;None&#39;</span>

<div class="viewcode-block" id="CgfFormat.Ref.get_size"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.get_size">[docs]</a>        <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return number of bytes this type occupies in a file.</span>

<span class="sd">            :return: Number of bytes.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="mi">4</span></div>

<div class="viewcode-block" id="CgfFormat.Ref.get_hash"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ref.get_hash">[docs]</a>        <span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a hash value for the chunk referred to.</span>

<span class="sd">            :return: An immutable object that can be used as a hash.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div></div>

<div class="viewcode-block" id="CgfFormat.Ptr"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ptr">[docs]</a>    <span class="k">class</span> <span class="nc">Ptr</span><span class="p">(</span><span class="n">Ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to a chunk, down the hierarchy.&quot;&quot;&quot;</span>
        <span class="n">_is_template</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">_has_links</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">_has_refs</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># avoid infinite recursion</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> instance at 0x</span><span class="si">%08X</span><span class="s1">&#39;</span>\
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;None&#39;</span>

<div class="viewcode-block" id="CgfFormat.Ptr.get_refs"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Ptr.get_refs">[docs]</a>        <span class="k">def</span> <span class="nf">get_refs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Ptr does not point down, so get_refs returns empty list.</span>

<span class="sd">            :return: C{[]}</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[]</span></div></div>

<div class="viewcode-block" id="CgfFormat.version_number"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.version_number">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">version_number</span><span class="p">(</span><span class="n">version_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts version string into an integer.</span>

<span class="sd">        :param version_str: The version string.</span>
<span class="sd">        :type version_str: str</span>
<span class="sd">        :return: A version integer.</span>

<span class="sd">        &gt;&gt;&gt; hex(CgfFormat.version_number(&#39;744&#39;))</span>
<span class="sd">        &#39;0x744&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">version_str</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></div>

    <span class="c1"># exceptions</span>
<div class="viewcode-block" id="CgfFormat.CgfError"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.CgfError">[docs]</a>    <span class="k">class</span> <span class="nc">CgfError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exception for CGF specific errors.&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="CgfFormat.Data"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data">[docs]</a>    <span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">pyffi</span><span class="o">.</span><span class="n">object_models</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">Data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A class to contain the actual cgf data.</span>

<span class="sd">        Note that L{versions} and L{chunk_table} are not automatically kept</span>
<span class="sd">        in sync with the L{chunks}, but they are</span>
<span class="sd">        resynchronized when calling L{write}.</span>

<span class="sd">        :ivar game: The cgf game.</span>
<span class="sd">        :type game: ``int``</span>
<span class="sd">        :ivar header: The cgf header.</span>
<span class="sd">        :type header: L{CgfFormat.Header}</span>
<span class="sd">        :ivar chunks: List of chunks (the actual data).</span>
<span class="sd">        :type chunks: ``list`` of L{CgfFormat.Chunk}</span>
<span class="sd">        :ivar versions: List of chunk versions.</span>
<span class="sd">        :type versions: ``list`` of L{int}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_link_stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_block_index_dct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_block_dct</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="mh">0xffff0000</span><span class="p">,</span> <span class="n">game</span><span class="o">=</span><span class="s2">&quot;Far Cry&quot;</span><span class="p">):</span>
            <span class="c1"># 0xffff0000 = CgfFormat.FileType.GEOM</span>

            <span class="sd">&quot;&quot;&quot;Initialize cgf data. By default, this creates an empty</span>
<span class="sd">            cgf document of the given filetype and game.</span>

<span class="sd">            :param filetype: The file type (animation, or geometry).</span>
<span class="sd">            :type filetype: ``int``</span>
<span class="sd">            :param game: The game.</span>
<span class="sd">            :type game: ``str``</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># create new header</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">filetype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mh">0x744</span> <span class="c1"># no other chunk table versions</span>
            <span class="c1"># empty list of chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># empty list of versions (one per chunk)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># chunk table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkTable</span><span class="p">()</span>
            <span class="c1"># game</span>
            <span class="c1"># TODO store this in a way that can be displayed by qskope</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">game</span>
            <span class="c1"># set version and user version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Far Cry&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_FARCRY</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Crysis&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_CRYSIS</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Aion&quot;</span><span class="p">:</span>
                <span class="c1"># XXX guessing for Aion!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_FARCRY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown game </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">game</span><span class="p">)</span>

        <span class="c1"># new functions</span>

<div class="viewcode-block" id="CgfFormat.Data.inspect_version_only"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.inspect_version_only">[docs]</a>        <span class="k">def</span> <span class="nf">inspect_version_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;This function checks the version only, and is faster</span>
<span class="sd">            than the usual inspect function (which reads the full</span>
<span class="sd">            chunk table). Sets the L{header} and L{game} instance</span>
<span class="sd">            variables if the stream contains a valid cgf file.</span>

<span class="sd">            Call this function if you simply wish to check that a file is</span>
<span class="sd">            a cgf file without having to parse even the header.</span>

<span class="sd">            :raise ``ValueError``: If the stream does not contain a cgf file.</span>
<span class="sd">            :param stream: The stream from which to read.</span>
<span class="sd">            :type stream: ``file``</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">signat</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">filetype</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;III&#39;</span><span class="p">,</span>
                                                          <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># something went wrong with unpack</span>
                <span class="c1"># this means that the file is less than 20 bytes</span>
                <span class="c1"># cannot be a cgf file</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;File too small to be a cgf file.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

            <span class="c1"># test the data</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">signat</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;CryTek&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">signat</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NCAion&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid signature (got &#39;</span><span class="si">%s</span><span class="s2">&#39; instead of &#39;CryTek&#39; or &#39;NCAion&#39;)&quot;</span>
                    <span class="o">%</span> <span class="n">signat</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">filetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">FileType</span><span class="o">.</span><span class="n">GEOM</span><span class="p">,</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">FileType</span><span class="o">.</span><span class="n">ANIM</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid file type.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">versions</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid file version.&quot;</span><span class="p">)</span>
            <span class="c1"># quick and lame game check:</span>
            <span class="c1"># far cry has chunk table at the end, crysis at the start</span>
            <span class="k">if</span> <span class="n">signat</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NCAion&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="s2">&quot;Aion&quot;</span>
            <span class="k">elif</span> <span class="n">offset</span> <span class="o">==</span> <span class="mh">0x14</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="s2">&quot;Crysis&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="s2">&quot;Far Cry&quot;</span>
            <span class="c1"># load the actual header</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="c1"># set version and user version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Far Cry&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_FARCRY</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Crysis&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_CRYSIS</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Aion&quot;</span><span class="p">:</span>
                <span class="c1"># XXX guessing for Aion!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_FARCRY</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown game </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">game</span><span class="p">)</span></div>

        <span class="c1"># GlobalNode</span>

<div class="viewcode-block" id="CgfFormat.Data.get_global_child_nodes"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.get_global_child_nodes">[docs]</a>        <span class="k">def</span> <span class="nf">get_global_child_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_filter</span><span class="o">=</span><span class="n">EdgeFilter</span><span class="p">()):</span>
            <span class="sd">&quot;&quot;&quot;Returns chunks without parent.&quot;&quot;&quot;</span>
            <span class="c1"># calculate all children of all chunks</span>
            <span class="n">children</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">:</span>
                <span class="n">children</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">get_global_child_nodes</span><span class="p">())</span>
            <span class="c1"># iterate over all chunks that are NOT in the list of children</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">chunk</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span></div>

        <span class="c1"># DetailNode</span>

<div class="viewcode-block" id="CgfFormat.Data.replace_global_node"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.replace_global_node">[docs]</a>        <span class="k">def</span> <span class="nf">replace_global_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldbranch</span><span class="p">,</span> <span class="n">newbranch</span><span class="p">,</span>
                                <span class="n">edge_filter</span><span class="o">=</span><span class="n">EdgeFilter</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">chunk</span> <span class="ow">is</span> <span class="n">oldbranch</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newbranch</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="o">.</span><span class="n">replace_global_node</span><span class="p">(</span><span class="n">oldbranch</span><span class="p">,</span> <span class="n">newbranch</span><span class="p">,</span>
                                            <span class="n">edge_filter</span><span class="o">=</span><span class="n">edge_filter</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Data.get_detail_child_nodes"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.get_detail_child_nodes">[docs]</a>        <span class="k">def</span> <span class="nf">get_detail_child_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_filter</span><span class="o">=</span><span class="n">EdgeFilter</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span></div>

<div class="viewcode-block" id="CgfFormat.Data.get_detail_child_names"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.get_detail_child_names">[docs]</a>        <span class="k">def</span> <span class="nf">get_detail_child_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_filter</span><span class="o">=</span><span class="n">EdgeFilter</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="s2">&quot;header&quot;</span>
            <span class="k">yield</span> <span class="s2">&quot;chunk table&quot;</span></div>

        <span class="c1"># overriding pyffi.object_models.FileFormat.Data methods</span>

<div class="viewcode-block" id="CgfFormat.Data.inspect"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.inspect">[docs]</a>        <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Quickly checks whether the stream appears to contain</span>
<span class="sd">            cgf data, and read the cgf header and chunk table. Resets stream to</span>
<span class="sd">            original position.</span>

<span class="sd">            Call this function if you only need to inspect the header and</span>
<span class="sd">            chunk table.</span>

<span class="sd">            :param stream: The file to inspect.</span>
<span class="sd">            :type stream: ``file``</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pyffi.cgf.data&quot;</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading header at 0x</span><span class="si">%08X</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inspect_version_only</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading chunk table version 0x</span><span class="si">%08X</span><span class="s2"> at 0x</span><span class="si">%08X</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Data.read"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.read">[docs]</a>        <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Read a cgf file. Does not reset stream position.</span>

<span class="sd">            :param stream: The stream from which to read.</span>
<span class="sd">            :type stream: ``file``</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># whether we validate on reading</span>
            
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pyffi.cgf.data&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="c1"># is it a caf file? these are missing chunk headers on controllers</span>
            <span class="c1"># (note: stream.name may not be a python string for some file</span>
            <span class="c1"># implementations, notably PyQt4, so convert it explicitely)</span>
            <span class="n">is_caf</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.caf&quot;</span><span class="p">)</span>

            <span class="n">chunk_types</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">chunk_type</span> <span class="k">for</span> <span class="n">chunk_type</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="p">)</span> \
                <span class="k">if</span> <span class="n">chunk_type</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;__&#39;</span><span class="p">]</span>

            <span class="c1"># get the chunk sizes (for double checking that we have all data)</span>
            <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                <span class="n">chunk_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span>
                                 <span class="k">for</span> <span class="n">chunkhdr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">chunk_headers</span><span class="p">]</span>
                <span class="n">chunk_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">chunkhdr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">chunk_headers</span><span class="p">:</span>
                    <span class="n">next_chunk_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">offset</span> <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">chunk_offsets</span>
                                          <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">next_chunk_offsets</span><span class="p">:</span>
                        <span class="n">chunk_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">next_chunk_offsets</span><span class="p">)</span> <span class="o">-</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="n">chunk_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

            <span class="c1"># read the chunks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_link_stack</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of chunk identifiers, as added to the stack</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_block_dct</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># maps chunk index to actual chunk</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># records all chunks as read from cgf file in proper order</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># records all chunk versions as read from cgf file</span>
            <span class="k">for</span> <span class="n">chunknum</span><span class="p">,</span> <span class="n">chunkhdr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">chunk_headers</span><span class="p">):</span>
                <span class="c1"># check that id is unique</span>
                <span class="k">if</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_dct</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;chunk id </span><span class="si">%i</span><span class="s1"> not unique&#39;</span><span class="o">%</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                <span class="c1"># get chunk type</span>
                <span class="k">for</span> <span class="n">chunk_type</span> <span class="ow">in</span> <span class="n">chunk_types</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="p">,</span> <span class="n">chunk_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unknown chunk type 0x</span><span class="si">%08X</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">chunk</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">CgfFormat</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Chunk&#39;</span> <span class="o">%</span> <span class="n">chunk_type</span><span class="p">)()</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;undecoded chunk type 0x</span><span class="si">%08X</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">Chunk)&#39;</span>
                        <span class="o">%</span><span class="p">(</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">chunk_type</span><span class="p">))</span>
                <span class="c1"># check the chunk version</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">get_games</span><span class="p">():</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s1">&#39;game </span><span class="si">%s</span><span class="s1"> does not support </span><span class="si">%s</span><span class="s1">Chunk; &#39;</span>
                        <span class="s1">&#39;trying anyway&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="p">,</span> <span class="n">chunk_type</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s1">&#39;chunk version 0x</span><span class="si">%08X</span><span class="s1"> not supported for &#39;</span>
                        <span class="s1">&#39;game </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1">Chunk; &#39;</span>
                        <span class="s1">&#39;trying anyway&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="p">,</span> <span class="n">chunk_type</span><span class="p">))</span>

                <span class="c1"># now read the chunk</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading </span><span class="si">%s</span><span class="s2"> chunk version 0x</span><span class="si">%08X</span><span class="s2"> at 0x</span><span class="si">%08X</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">chunk_type</span><span class="p">,</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()))</span>

                <span class="c1"># in far cry, most chunks start with a copy of chunkhdr</span>
                <span class="c1"># in crysis, more chunks start with chunkhdr</span>
                <span class="c1"># caf files are special: they don&#39;t have headers on controllers</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">==</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_FARCRY</span>
                       <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">SourceInfo</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneNameList</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneLightBinding</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneInitialPos</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">MeshMorphTarget</span><span class="p">])</span> \
                    <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">==</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_CRYSIS</span>
                            <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneNameList</span><span class="p">,</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneInitialPos</span><span class="p">])</span> \
                    <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">is_caf</span>
                            <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">Controller</span><span class="p">])</span> \
                    <span class="ow">and</span> <span class="ow">not</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">==</span> <span class="s2">&quot;Aion&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">MeshPhysicsData</span><span class="p">,</span>
                        <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">MtlName</span><span class="p">]):</span>
                    <span class="n">chunkhdr_copy</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkHeader</span><span class="p">()</span>
                    <span class="n">chunkhdr_copy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                    <span class="c1"># check that the copy is valid</span>
                    <span class="c1"># note: chunkhdr_copy.offset != chunkhdr.offset check removed</span>
                    <span class="c1"># as many crysis cgf files have this wrong</span>
                    <span class="k">if</span> <span class="n">chunkhdr_copy</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> \
                       <span class="ow">or</span> <span class="n">chunkhdr_copy</span><span class="o">.</span><span class="n">version</span> <span class="o">!=</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span> \
                       <span class="ow">or</span> <span class="n">chunkhdr_copy</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s1">&#39;chunk starts with invalid header:</span><span class="se">\n\</span>
<span class="s1">expected</span><span class="se">\n</span><span class="si">%s</span><span class="s1">but got</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">chunkhdr</span><span class="p">,</span> <span class="n">chunkhdr_copy</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">chunkhdr_copy</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># quick hackish trick with version... not beautiful but it works</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_block_dct</span><span class="p">[</span><span class="n">chunkhdr</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span>

                <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
                    <span class="c1"># calculate size</span>
                    <span class="c1"># (quick hackish trick with version)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">size</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span>
                    <span class="c1"># take into account header copy</span>
                    <span class="k">if</span> <span class="n">chunkhdr_copy</span><span class="p">:</span>
                        <span class="n">size</span> <span class="o">+=</span> <span class="n">chunkhdr_copy</span><span class="o">.</span><span class="n">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="c1"># check with number of bytes read</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">get_size returns wrong size when reading </span><span class="si">%s</span><span class="s2"> at 0x</span><span class="si">%08X</span><span class="s2"></span>
<span class="s2">actual bytes read is </span><span class="si">%i</span><span class="s2">, get_size yields </span><span class="si">%i</span><span class="s2"> (expected </span><span class="si">%i</span><span class="s2"> bytes)&quot;&quot;&quot;</span>
                                    <span class="o">%</span> <span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                       <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                       <span class="n">size</span><span class="p">,</span>
                                       <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                       <span class="n">chunk_sizes</span><span class="p">[</span><span class="n">chunknum</span><span class="p">]))</span>
                    <span class="c1"># check for padding bytes</span>
                    <span class="k">if</span> <span class="n">chunk_sizes</span><span class="p">[</span><span class="n">chunknum</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">padlen</span> <span class="o">=</span> <span class="p">((</span><span class="mi">4</span> <span class="o">-</span> <span class="n">size</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span>
                        <span class="c1">#assert(stream.read(padlen) == &#39;\x00&#39; * padlen)</span>
                        <span class="n">size</span> <span class="o">+=</span> <span class="n">padlen</span>
                    <span class="c1"># check size</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">chunk_sizes</span><span class="p">[</span><span class="n">chunknum</span><span class="p">]:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">chunk size mismatch when reading </span><span class="si">%s</span><span class="s2"> at 0x</span><span class="si">%08X</span><span class="s2"></span>
<span class="si">%i</span><span class="s2"> bytes available, but actual bytes read is </span><span class="si">%i</span><span class="s2">&quot;&quot;&quot;</span>
                                    <span class="o">%</span> <span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                       <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
                                       <span class="n">chunk_sizes</span><span class="p">[</span><span class="n">chunknum</span><span class="p">],</span> <span class="n">size</span><span class="p">))</span>

            <span class="c1"># fix links</span>
            <span class="k">for</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">chunkversion</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">):</span>
                <span class="c1"># (quick hackish trick with version)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">chunkversion</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1">#print(chunk.__class__)</span>
                    <span class="n">chunk</span><span class="o">.</span><span class="n">fix_links</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_stack</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="k">raise</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">CgfError</span><span class="p">(</span>
                    <span class="s1">&#39;not all links have been popped from the stack (bug?)&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Data.write"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.write">[docs]</a>        <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Write a cgf file. The L{header} and L{chunk_table} are</span>
<span class="sd">            recalculated from L{chunks}. Returns number of padding bytes</span>
<span class="sd">            written (this is for debugging purposes only).</span>

<span class="sd">            :param stream: The stream to which to write.</span>
<span class="sd">            :type stream: file</span>
<span class="sd">            :return: Number of padding bytes written.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pyffi.cgf.data&quot;</span><span class="p">)</span>
            <span class="c1"># is it a caf file? these are missing chunk headers on controllers</span>
            <span class="n">is_caf</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.caf&quot;</span><span class="p">)</span>

            <span class="c1"># variable to track number of padding bytes</span>
            <span class="n">total_padding</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># chunk versions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_versions</span><span class="p">()</span>

            <span class="c1"># write header</span>
            <span class="n">hdr_pos</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># is set at the end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># chunk id is simply its index in the chunks list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_block_index_dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">))</span>

            <span class="c1"># write chunks and add headers to chunk table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkTable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">num_chunks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">chunk_headers</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
            <span class="c1">#print(self.chunk_table) # DEBUG</span>

            <span class="c1"># crysis: write chunk table now</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">==</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_CRYSIS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">chunkhdr</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">chunkversion</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">chunk_headers</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">versions</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing </span><span class="si">%s</span><span class="s2"> chunk version 0x</span><span class="si">%08X</span><span class="s2"> at 0x</span><span class="si">%08X</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()))</span>

                <span class="c1"># set up chunk header</span>
                <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="p">,</span> <span class="n">chunk</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">chunkhdr</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">chunkversion</span>
                <span class="n">chunkhdr</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="n">chunkhdr</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_index_dct</span><span class="p">[</span><span class="n">chunk</span><span class="p">]</span>
                <span class="c1"># write chunk header</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">==</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_FARCRY</span>
                       <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">SourceInfo</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneNameList</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneLightBinding</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneInitialPos</span><span class="p">,</span>
                           <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">MeshMorphTarget</span><span class="p">])</span> \
                    <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">==</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_CRYSIS</span>
                            <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneNameList</span><span class="p">,</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">BoneInitialPos</span><span class="p">])</span> \
                    <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">is_caf</span>
                            <span class="ow">and</span> <span class="n">chunkhdr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="n">CgfFormat</span><span class="o">.</span><span class="n">ChunkType</span><span class="o">.</span><span class="n">Controller</span><span class="p">]):</span>
                    <span class="c1">#print(chunkhdr) # DEBUG</span>
                    <span class="n">chunkhdr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="c1"># write chunk (with version hack)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">chunkversion</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">chunk</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span>
                <span class="c1"># write padding bytes to align blocks</span>
                <span class="n">padlen</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span>
                <span class="k">if</span> <span class="n">padlen</span><span class="p">:</span>
                    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">padlen</span><span class="p">)</span>
                    <span class="n">total_padding</span> <span class="o">+=</span> <span class="n">padlen</span>

            <span class="c1"># write/update chunk table</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing chunk table version 0x</span><span class="si">%08X</span><span class="s2"> at 0x</span><span class="si">%08X</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_version</span> <span class="o">==</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">UVER_CRYSIS</span><span class="p">:</span>
                <span class="n">end_pos</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chunk_table</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="n">end_pos</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

            <span class="c1"># update header</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">hdr_pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># seek end of written data</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">end_pos</span><span class="p">)</span>

            <span class="c1"># return number of padding bytes written</span>
            <span class="k">return</span> <span class="n">total_padding</span></div>

<div class="viewcode-block" id="CgfFormat.Data.update_versions"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Data.update_versions">[docs]</a>        <span class="k">def</span> <span class="nf">update_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Update L{versions} for the given chunks and game.&quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="p">))</span>
                                 <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunks</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">CgfError</span><span class="p">(</span><span class="s2">&quot;game </span><span class="si">%s</span><span class="s2"> not supported&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="p">)</span></div></div>

    <span class="c1"># extensions of generated structures</span>

<div class="viewcode-block" id="CgfFormat.Chunk"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Chunk">[docs]</a>    <span class="k">class</span> <span class="nc">Chunk</span><span class="p">:</span>
<div class="viewcode-block" id="CgfFormat.Chunk.tree"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Chunk.tree">[docs]</a>        <span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">follow_all</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;A generator for parsing all blocks in the tree (starting from and</span>
<span class="sd">            including C{self}).</span>

<span class="sd">            :param block_type: If not ``None``, yield only blocks of the type C{block_type}.</span>
<span class="sd">            :param follow_all: If C{block_type} is not ``None``, then if this is ``True`` the function will parse the whole tree. Otherwise, the function will not follow branches that start by a non-C{block_type} block.&quot;&quot;&quot;</span>
            <span class="c1"># yield self</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">block_type</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_type</span><span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">follow_all</span><span class="p">:</span>
                <span class="k">return</span> <span class="c1"># don&#39;t recurse further</span>

            <span class="c1"># yield tree attached to each child</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_refs</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span><span class="n">block_type</span> <span class="o">=</span> <span class="n">block_type</span><span class="p">,</span> <span class="n">follow_all</span> <span class="o">=</span> <span class="n">follow_all</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">block</span></div>

<div class="viewcode-block" id="CgfFormat.Chunk.apply_scale"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Chunk.apply_scale">[docs]</a>        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">pass</span></div></div>

<div class="viewcode-block" id="CgfFormat.ChunkTable"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.ChunkTable">[docs]</a>    <span class="k">class</span> <span class="nc">ChunkTable</span><span class="p">:</span>
<div class="viewcode-block" id="CgfFormat.ChunkTable.get_chunk_types"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.ChunkTable.get_chunk_types">[docs]</a>        <span class="k">def</span> <span class="nf">get_chunk_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Iterate all chunk types (in the form of Python classes) referenced</span>
<span class="sd">            in this table.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">CHUNK_MAP</span><span class="p">[</span><span class="n">chunk_header</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">chunk_header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_headers</span><span class="p">)</span></div></div>

    <span class="k">class</span> <span class="nc">BoneInitialPosChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_pos_matrices</span><span class="p">:</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>

        <span class="k">def</span> <span class="nf">get_global_node_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get the block parent (used for instance in the QSkope global</span>
<span class="sd">            view).&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>

<div class="viewcode-block" id="CgfFormat.DataStreamChunk"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.DataStreamChunk">[docs]</a>    <span class="k">class</span> <span class="nc">DataStreamChunk</span><span class="p">:</span>
<div class="viewcode-block" id="CgfFormat.DataStreamChunk.apply_scale"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.DataStreamChunk.apply_scale">[docs]</a>        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="n">vert</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">vert</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">vert</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span></div></div>

<div class="viewcode-block" id="CgfFormat.Matrix33"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33">[docs]</a>    <span class="k">class</span> <span class="nc">Matrix33</span><span class="p">:</span>
<div class="viewcode-block" id="CgfFormat.Matrix33.as_list"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.as_list">[docs]</a>        <span class="k">def</span> <span class="nf">as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return matrix as 3x3 list.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">]</span>
                <span class="p">]</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.as_tuple"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.as_tuple">[docs]</a>        <span class="k">def</span> <span class="nf">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return matrix as 3x3 tuple.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">)</span>
                <span class="p">)</span></div>

        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span>
                <span class="s2">&quot;[ </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> ]</span><span class="se">\n</span><span class="s2">[ </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> ]</span><span class="se">\n</span><span class="s2">[ </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> ]</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">))</span>

<div class="viewcode-block" id="CgfFormat.Matrix33.set_identity"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.set_identity">[docs]</a>        <span class="k">def</span> <span class="nf">set_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set to identity matrix.&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.is_identity"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.is_identity">[docs]</a>        <span class="k">def</span> <span class="nf">is_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return ``True`` if the matrix is close to identity.&quot;&quot;&quot;</span>
            <span class="k">if</span>  <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                 <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.get_copy"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_copy">[docs]</a>        <span class="k">def</span> <span class="nf">get_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a copy of the matrix.&quot;&quot;&quot;</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span>
            <span class="k">return</span> <span class="n">mat</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.get_transpose"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_transpose">[docs]</a>        <span class="k">def</span> <span class="nf">get_transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get transposed of the matrix.&quot;&quot;&quot;</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span>
            <span class="k">return</span> <span class="n">mat</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.is_scale_rotation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.is_scale_rotation">[docs]</a>        <span class="k">def</span> <span class="nf">is_scale_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns true if the matrix decomposes nicely into scale * rotation.&quot;&quot;&quot;</span>
            <span class="c1"># NOTE: 0.01 instead of CgfFormat.EPSILON to work around bad files</span>

            <span class="c1"># calculate self * self^T</span>
            <span class="c1"># this should correspond to</span>
            <span class="c1"># (scale * rotation) * (scale * rotation)^T</span>
            <span class="c1"># = scale * rotation * rotation^T * scale^T</span>
            <span class="c1"># = scale * scale^T</span>
            <span class="n">self_transpose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transpose</span><span class="p">()</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">self_transpose</span>

            <span class="c1"># off diagonal elements should be zero</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">m_12</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">m_13</span><span class="p">)</span>
                <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">m_21</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">m_23</span><span class="p">)</span>
                <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">m_31</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">m_32</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.is_rotation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.is_rotation">[docs]</a>        <span class="k">def</span> <span class="nf">is_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns ``True`` if the matrix is a rotation matrix</span>
<span class="sd">            (a member of SO(3)).&quot;&quot;&quot;</span>
            <span class="c1"># NOTE: 0.01 instead of CgfFormat.EPSILON to work around bad files</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_scale_rotation</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> \
               <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> \
               <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.get_determinant"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_determinant">[docs]</a>        <span class="k">def</span> <span class="nf">get_determinant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return determinant.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_33</span>
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span>
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_32</span>
                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_13</span>
                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_33</span>
                    <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.get_scale"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_scale">[docs]</a>        <span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Gets the scale (assuming is_scale_rotation is true!).&quot;&quot;&quot;</span>
            <span class="c1"># calculate self * self^T</span>
            <span class="c1"># this should correspond to</span>
            <span class="c1"># (rotation * scale)* (rotation * scale)^T</span>
            <span class="c1"># = scale * scale^T</span>
            <span class="c1"># = diagonal matrix with scales squared on the diagonal</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transpose</span><span class="p">()</span>

            <span class="n">scale</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
            <span class="n">scale</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="n">scale</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="n">scale</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">**</span> <span class="mf">0.5</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_determinant</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">scale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">scale</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.get_scale_rotation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_scale_rotation">[docs]</a>        <span class="k">def</span> <span class="nf">get_scale_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Decompose the matrix into scale and rotation, where scale is a float</span>
<span class="sd">            and rotation is a C{Matrix33}. Returns a pair (scale, rotation).&quot;&quot;&quot;</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scale</span><span class="o">.</span><span class="n">as_tuple</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s1">&#39;scale is zero, unable to obtain rotation&#39;</span><span class="p">)</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_11</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_12</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_13</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_21</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_22</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_23</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_31</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_32</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span>
            <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.set_scale_rotation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.set_scale_rotation">[docs]</a>        <span class="k">def</span> <span class="nf">set_scale_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">rotation</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Compose the matrix as the product of scale * rotation.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;scale must be Vector3&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;rotation must be Matrix33&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">rotation</span><span class="o">.</span><span class="n">is_rotation</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rotation must be rotation matrix&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix33.get_scale_quat"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_scale_quat">[docs]</a>        <span class="k">def</span> <span class="nf">get_scale_quat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Decompose matrix into scale and quaternion.&quot;&quot;&quot;</span>
            <span class="n">scale</span><span class="p">,</span> <span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale_rotation</span><span class="p">()</span>
            <span class="n">quat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Quat</span><span class="p">()</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span>

            <span class="k">if</span> <span class="n">trace</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">trace</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_32</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_23</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_13</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_31</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_21</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_12</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">s</span>
            <span class="k">elif</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_11</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">((</span><span class="n">rot</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span><span class="p">)):</span>
                <span class="n">s</span>  <span class="o">=</span> <span class="p">((</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span> <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_12</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_31</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_32</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_23</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
            <span class="k">elif</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_22</span> <span class="o">&gt;</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span><span class="p">:</span>
                <span class="n">s</span>  <span class="o">=</span> <span class="p">((</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span> <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_12</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_32</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_23</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_13</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_31</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span>  <span class="o">=</span> <span class="p">((</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_22</span> <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_31</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_32</span> <span class="o">+</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_23</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">s</span>
                <span class="n">quat</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">rot</span><span class="o">.</span><span class="n">m_21</span> <span class="o">-</span> <span class="n">rot</span><span class="o">.</span><span class="n">m_12</span> <span class="p">)</span> <span class="o">/</span> <span class="n">s</span>

            <span class="k">return</span> <span class="n">scale</span><span class="p">,</span> <span class="n">quat</span></div>


<div class="viewcode-block" id="CgfFormat.Matrix33.get_inverse"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix33.get_inverse">[docs]</a>        <span class="k">def</span> <span class="nf">get_inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get inverse (assuming is_scale_rotation is true!).&quot;&quot;&quot;</span>
            <span class="c1"># transpose inverts rotation but keeps the scale</span>
            <span class="c1"># dividing by scale^2 inverts the scale as well</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">()</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transpose</span><span class="p">()</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">/=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span> <span class="o">**</span> <span class="mi">2</span></div>

        <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">rhs</span>
                <span class="k">return</span> <span class="n">mat</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;matrix*vector not supported;</span><span class="se">\</span>
<span class="s2">        please use left multiplication (vector*matrix)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">):</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_31</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_12</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_32</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_23</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_33</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_31</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_12</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_32</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_23</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_33</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_31</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_12</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_32</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_23</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">rhs</span><span class="o">.</span><span class="n">m_33</span>
                <span class="k">return</span> <span class="n">mat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;do not know how to multiply Matrix33 with </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">rhs</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">/</span> <span class="n">rhs</span>
                <span class="k">return</span> <span class="n">mat</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;do not know how to divide Matrix33 by </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">rhs</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">lhs</span> <span class="c1"># commutes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;do not know how to multiply </span><span class="si">%s</span><span class="s2"> with Matrix33&quot;</span><span class="o">%</span><span class="n">lhs</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;do not know how to compare Matrix33 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">mat</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44">[docs]</a>    <span class="k">class</span> <span class="nc">Matrix44</span><span class="p">:</span>
<div class="viewcode-block" id="CgfFormat.Matrix44.as_list"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.as_list">[docs]</a>        <span class="k">def</span> <span class="nf">as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return matrix as 4x4 list.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m_41</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span><span class="p">]</span>
                <span class="p">]</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.as_tuple"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.as_tuple">[docs]</a>        <span class="k">def</span> <span class="nf">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return matrix as 4x4 tuple.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span><span class="p">),</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_41</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.set_rows"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.set_rows">[docs]</a>        <span class="k">def</span> <span class="nf">set_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row0</span><span class="p">,</span> <span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">row3</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set matrix from rows.&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="n">row0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="n">row1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="n">row2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="n">row3</span></div>

        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span>
                <span class="s1">&#39;[ </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> ]</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;[ </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> ]</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;[ </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> ]</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;[ </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> </span><span class="si">%6.3f</span><span class="s1"> ]</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span><span class="p">))</span>

<div class="viewcode-block" id="CgfFormat.Matrix44.set_identity"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.set_identity">[docs]</a>        <span class="k">def</span> <span class="nf">set_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set to identity matrix.&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.is_identity"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.is_identity">[docs]</a>        <span class="k">def</span> <span class="nf">is_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return ``True`` if the matrix is close to identity.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_12</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_13</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_14</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_23</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_24</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_32</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_34</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_41</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_42</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_43</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span>
                <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.get_copy"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.get_copy">[docs]</a>        <span class="k">def</span> <span class="nf">get_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Create a copy of the matrix.&quot;&quot;&quot;</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span>
            <span class="k">return</span> <span class="n">mat</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.get_matrix_33"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.get_matrix_33">[docs]</a>        <span class="k">def</span> <span class="nf">get_matrix_33</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns upper left 3x3 part.&quot;&quot;&quot;</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span>
            <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span>
            <span class="k">return</span> <span class="n">m</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.set_matrix_33"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.set_matrix_33">[docs]</a>        <span class="k">def</span> <span class="nf">set_matrix_33</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Sets upper left 3x3 part.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;argument must be Matrix33&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_11</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_13</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_21</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_22</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_23</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_31</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_32</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">m_33</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.get_translation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.get_translation">[docs]</a>        <span class="k">def</span> <span class="nf">get_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns lower left 1x3 part.&quot;&quot;&quot;</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
            <span class="n">t</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span>
            <span class="n">t</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span>
            <span class="n">t</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span>
            <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.set_translation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.set_translation">[docs]</a>        <span class="k">def</span> <span class="nf">set_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translation</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Returns lower left 1x3 part.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">translation</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;argument must be Vector3&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">z</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.is_scale_rotation_translation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.is_scale_rotation_translation">[docs]</a>        <span class="k">def</span> <span class="nf">is_scale_rotation_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_matrix_33</span><span class="p">()</span><span class="o">.</span><span class="n">is_scale_rotation</span><span class="p">():</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_14</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_24</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_34</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.get_scale_rotation_translation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.get_scale_rotation_translation">[docs]</a>        <span class="k">def</span> <span class="nf">get_scale_rotation_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">rotscl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_matrix_33</span><span class="p">()</span>
            <span class="n">scale</span><span class="p">,</span> <span class="n">rot</span> <span class="o">=</span> <span class="n">rotscl</span><span class="o">.</span><span class="n">get_scale_rotation</span><span class="p">()</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">trans</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.get_scale_quat_translation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.get_scale_quat_translation">[docs]</a>        <span class="k">def</span> <span class="nf">get_scale_quat_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">rotscl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_matrix_33</span><span class="p">()</span>
            <span class="n">scale</span><span class="p">,</span> <span class="n">quat</span> <span class="o">=</span> <span class="n">rotscl</span><span class="o">.</span><span class="n">get_scale_quat</span><span class="p">()</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_translation</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">trans</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.set_scale_rotation_translation"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.set_scale_rotation_translation">[docs]</a>        <span class="k">def</span> <span class="nf">set_scale_rotation_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">translation</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;scale must be Vector3&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;rotation must be Matrix33&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">translation</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;translation must be Vector3&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">rotation</span><span class="o">.</span><span class="n">is_rotation</span><span class="p">():</span>
                <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pyffi.cgf.matrix&quot;</span><span class="p">)</span>
                <span class="n">mat</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">*</span> <span class="n">rotation</span><span class="o">.</span><span class="n">get_transpose</span><span class="p">()</span>
                <span class="n">idmat</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">()</span>
                <span class="n">idmat</span><span class="o">.</span><span class="n">set_identity</span><span class="p">()</span>
                <span class="n">error</span> <span class="o">=</span> <span class="p">(</span><span class="n">mat</span> <span class="o">-</span> <span class="n">idmat</span><span class="p">)</span><span class="o">.</span><span class="n">sup_norm</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;improper rotation matrix (error is </span><span class="si">%f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">error</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  matrix =&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  its determinant = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rotation</span><span class="o">.</span><span class="n">get_determinant</span><span class="p">())</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  matrix * matrix^T =&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="mf">1.0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_matrix_33</span><span class="p">(</span><span class="n">rotation</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_translation</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Matrix44.get_inverse"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.get_inverse">[docs]</a>        <span class="k">def</span> <span class="nf">get_inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Calculates inverse (fast assumes is_scale_rotation_translation is True).&quot;&quot;&quot;</span>
            <span class="k">def</span> <span class="nf">adjoint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">ii</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">jj</span><span class="p">:</span> <span class="k">continue</span>
                        <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">def</span> <span class="nf">determinant</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)):</span>
                    <span class="n">det</span> <span class="o">=</span> <span class="n">determinant</span><span class="p">(</span><span class="n">adjoint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">-=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">det</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">+=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">det</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="k">if</span> <span class="n">fast</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_matrix_33</span><span class="p">()</span><span class="o">.</span><span class="n">get_inverse</span><span class="p">()</span>
                <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_translation</span><span class="p">()</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>

                <span class="n">n</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">n</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">n</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">n</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">n</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">n</span><span class="o">.</span><span class="n">set_matrix_33</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">n</span><span class="o">.</span><span class="n">set_translation</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">n</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span>
                <span class="n">nn</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
                <span class="n">det</span> <span class="o">=</span> <span class="n">determinant</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s1">&#39;cannot invert matrix:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">nn</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">determinant</span><span class="p">(</span><span class="n">adjoint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span> <span class="o">/</span> <span class="n">det</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">nn</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">determinant</span><span class="p">(</span><span class="n">adjoint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span> <span class="o">/</span> <span class="n">det</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">n</span><span class="o">.</span><span class="n">set_rows</span><span class="p">(</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">n</span></div>

        <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">*</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;matrix*vector not supported; please use left multiplication (vector*matrix)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector4</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;matrix*vector not supported; please use left multiplication (vector*matrix)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_41</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_42</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_43</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_14</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_24</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_34</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_44</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_41</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_42</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_43</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_14</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_24</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_34</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_44</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_41</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_42</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_43</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_14</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_24</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_34</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_44</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_41</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_42</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_43</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_14</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_24</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_34</span>  <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_44</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to multiply Matrix44 with </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">/</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to divide Matrix44 by </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to multiply </span><span class="si">%s</span><span class="s2"> with Matrix44&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to compare Matrix44 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">m</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_11</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_12</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_13</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_14</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_21</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_22</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_23</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_24</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_31</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_32</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_33</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_34</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_41</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_42</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_43</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">m_44</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">)):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_14</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_24</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_34</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_41</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_42</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_43</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">m_44</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">+</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to add Matrix44 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">)):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_14</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_24</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_34</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_41</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_42</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_43</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">m_44</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_11</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_12</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_13</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_14</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_21</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_22</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_23</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_24</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_24</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_31</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_32</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_33</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_34</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_34</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_41</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_42</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_43</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">m</span><span class="o">.</span><span class="n">m_44</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_44</span> <span class="o">-</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to substract Matrix44 and </span><span class="si">%s</span><span class="s2">&quot;</span>
                                <span class="o">%</span> <span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

<div class="viewcode-block" id="CgfFormat.Matrix44.sup_norm"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Matrix44.sup_norm">[docs]</a>        <span class="k">def</span> <span class="nf">sup_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Calculate supremum norm of matrix (maximum absolute value of all</span>
<span class="sd">            entries).&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_list</span><span class="p">())</span></div></div>

    <span class="k">class</span> <span class="nc">MeshChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="n">vert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">vert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">vert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>

        <span class="k">def</span> <span class="nf">get_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all vertices.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">vert</span><span class="o">.</span><span class="n">p</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">vert</span>

        <span class="k">def</span> <span class="nf">get_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all normals.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">vert</span><span class="o">.</span><span class="n">n</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">norm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">normals</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">norm</span>

        <span class="k">def</span> <span class="nf">get_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all vertex colors.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">:</span>
                    <span class="c1"># Far Cry has no alpha channel</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">rgb_colors</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">rgb_colors</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">rgba_colors</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">rgba_colors</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_num_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get number of triangles.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_faces</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">//</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">get_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all triangles.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">face</span><span class="o">.</span><span class="n">v_0</span><span class="p">,</span> <span class="n">face</span><span class="o">.</span><span class="n">v_1</span><span class="p">,</span> <span class="n">face</span><span class="o">.</span><span class="n">v_2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="p">:</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">indices</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
                   <span class="k">yield</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">get_material_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all materials (per triangle).&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">face</span><span class="o">.</span><span class="n">material</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">meshsubset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meshsubset</span><span class="o">.</span><span class="n">num_indices</span> <span class="o">//</span> <span class="mi">3</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">meshsubset</span><span class="o">.</span><span class="n">mat_id</span>

        <span class="k">def</span> <span class="nf">get_uvs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all uv coordinates.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">uv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvs</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">uv</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">uv</span><span class="o">.</span><span class="n">v</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">uv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">uvs</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">uv</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">uv</span><span class="o">.</span><span class="n">v</span> <span class="c1"># OpenGL fix!</span>

        <span class="k">def</span> <span class="nf">get_uv_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generator for all uv triangles.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_faces</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">uvface</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_faces</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">uvface</span><span class="o">.</span><span class="n">t_0</span><span class="p">,</span> <span class="n">uvface</span><span class="o">.</span><span class="n">t_1</span><span class="p">,</span> <span class="n">uvface</span><span class="o">.</span><span class="n">t_2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="p">:</span>
                <span class="c1"># Crysis: UV triangles coincide with triangles</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">indices</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
                   <span class="k">yield</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">inds</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1">### DEPRECATED: USE set_geometry INSTEAD ###</span>
        <span class="k">def</span> <span class="nf">set_vertices_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;B{Deprecated. Use L{set_geometry} instead.} Set vertices and normals. This used to be the first function to call</span>
<span class="sd">            when setting mesh geometry data.</span>

<span class="sd">            Returns list of chunks that have been added.&quot;&quot;&quot;</span>
            <span class="c1"># Far Cry</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="c1"># Crysis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">VERTICES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">NORMALS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="c1"># set vertex coordinates and normals for Far Cry</span>
            <span class="k">for</span> <span class="n">cryvert</span><span class="p">,</span> <span class="n">vert</span><span class="p">,</span> <span class="n">norm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="c1"># set vertex coordinates and normals for Crysis</span>
            <span class="k">for</span> <span class="n">cryvert</span><span class="p">,</span> <span class="n">crynorm</span><span class="p">,</span> <span class="n">vert</span><span class="p">,</span> <span class="n">norm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">normals</span><span class="p">,</span>
                                                     <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cryvert</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">crynorm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">crynorm</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">crynorm</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1">### STILL WIP!!! ###</span>
        <span class="k">def</span> <span class="nf">set_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">verticeslist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">normalslist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">triangleslist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">matlist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">uvslist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">colorslist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Set geometry data.</span>

<span class="sd">            &gt;&gt;&gt; from pyffi.formats.cgf import CgfFormat</span>
<span class="sd">            &gt;&gt;&gt; chunk = CgfFormat.MeshChunk()</span>
<span class="sd">            &gt;&gt;&gt; vertices1 = [(0,0,0),(0,1,0),(1,0,0),(1,1,0)]</span>
<span class="sd">            &gt;&gt;&gt; vertices2 = [(0,0,1),(0,1,1),(1,0,1),(1,1,1)]</span>
<span class="sd">            &gt;&gt;&gt; normals1 = [(0,0,-1),(0,0,-1),(0,0,-1),(0,0,-1)]</span>
<span class="sd">            &gt;&gt;&gt; normals2 = [(0,0,1),(0,0,1),(0,0,1),(0,0,1)]</span>
<span class="sd">            &gt;&gt;&gt; triangles1 = [(0,1,2),(2,1,3)]</span>
<span class="sd">            &gt;&gt;&gt; triangles2 = [(0,1,2),(2,1,3)]</span>
<span class="sd">            &gt;&gt;&gt; uvs1 = [(0,0),(0,1),(1,0),(1,1)]</span>
<span class="sd">            &gt;&gt;&gt; uvs2 = [(0,0),(0,1),(1,0),(1,1)]</span>
<span class="sd">            &gt;&gt;&gt; colors1 = [(0,1,2,3),(4,5,6,7),(8,9,10,11),(12,13,14,15)]</span>
<span class="sd">            &gt;&gt;&gt; colors_2 = [(50,51,52,53),(54,55,56,57),(58,59,60,61),(62,63,64,65)]</span>
<span class="sd">            &gt;&gt;&gt; chunk.set_geometry(verticeslist = [vertices1, vertices2],</span>
<span class="sd">            ...                   normalslist = [normals1, normals2],</span>
<span class="sd">            ...                   triangleslist = [triangles1, triangles2],</span>
<span class="sd">            ...                   uvslist = [uvs1, uvs2],</span>
<span class="sd">            ...                   matlist = [2,5],</span>
<span class="sd">            ...                   colorslist = [colors1, colors_2])</span>
<span class="sd">            &gt;&gt;&gt; print(chunk) # doctest: +ELLIPSIS +REPORT_UDIFF</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.MeshChunk&#39;&gt; instance at ...</span>
<span class="sd">            * has_vertex_weights : False</span>
<span class="sd">            * has_vertex_colors : True</span>
<span class="sd">            * in_world_space : False</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * flags_1 : 0</span>
<span class="sd">            * flags_2 : 0</span>
<span class="sd">            * num_vertices : 8</span>
<span class="sd">            * num_indices : 12</span>
<span class="sd">            * num_uvs : 8</span>
<span class="sd">            * num_faces : 4</span>
<span class="sd">            * material : None</span>
<span class="sd">            * num_mesh_subsets : 2</span>
<span class="sd">            * mesh_subsets : &lt;class &#39;pyffi.formats.cgf.MeshSubsetsChunk&#39;&gt; instance at ...</span>
<span class="sd">            * vert_anim : None</span>
<span class="sd">            * vertices :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  0.000  0.000  0.000 ]</span>
<span class="sd">                * n : [  0.000  0.000 -1.000 ]</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  0.000  1.000  0.000 ]</span>
<span class="sd">                * n : [  0.000  0.000 -1.000 ]</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  1.000  0.000  0.000 ]</span>
<span class="sd">                * n : [  0.000  0.000 -1.000 ]</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  1.000  1.000  0.000 ]</span>
<span class="sd">                * n : [  0.000  0.000 -1.000 ]</span>
<span class="sd">                4: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  0.000  0.000  1.000 ]</span>
<span class="sd">                * n : [  0.000  0.000  1.000 ]</span>
<span class="sd">                5: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  0.000  1.000  1.000 ]</span>
<span class="sd">                * n : [  0.000  0.000  1.000 ]</span>
<span class="sd">                6: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  1.000  0.000  1.000 ]</span>
<span class="sd">                * n : [  0.000  0.000  1.000 ]</span>
<span class="sd">                7: &lt;class &#39;pyffi.formats.cgf.Vertex&#39;&gt; instance at ...</span>
<span class="sd">                * p : [  1.000  1.000  1.000 ]</span>
<span class="sd">                * n : [  0.000  0.000  1.000 ]</span>
<span class="sd">            * faces :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.Face&#39;&gt; instance at ...</span>
<span class="sd">                * v_0 : 0</span>
<span class="sd">                * v_1 : 1</span>
<span class="sd">                * v_2 : 2</span>
<span class="sd">                * material : 2</span>
<span class="sd">                * sm_group : 1</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.Face&#39;&gt; instance at ...</span>
<span class="sd">                * v_0 : 2</span>
<span class="sd">                * v_1 : 1</span>
<span class="sd">                * v_2 : 3</span>
<span class="sd">                * material : 2</span>
<span class="sd">                * sm_group : 1</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.Face&#39;&gt; instance at ...</span>
<span class="sd">                * v_0 : 4</span>
<span class="sd">                * v_1 : 5</span>
<span class="sd">                * v_2 : 6</span>
<span class="sd">                * material : 5</span>
<span class="sd">                * sm_group : 1</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.Face&#39;&gt; instance at ...</span>
<span class="sd">                * v_0 : 6</span>
<span class="sd">                * v_1 : 5</span>
<span class="sd">                * v_2 : 7</span>
<span class="sd">                * material : 5</span>
<span class="sd">                * sm_group : 1</span>
<span class="sd">            * uvs :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                4: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                5: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                6: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                7: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">            * uv_faces :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.UVFace&#39;&gt; instance at ...</span>
<span class="sd">                * t_0 : 0</span>
<span class="sd">                * t_1 : 1</span>
<span class="sd">                * t_2 : 2</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.UVFace&#39;&gt; instance at ...</span>
<span class="sd">                * t_0 : 2</span>
<span class="sd">                * t_1 : 1</span>
<span class="sd">                * t_2 : 3</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.UVFace&#39;&gt; instance at ...</span>
<span class="sd">                * t_0 : 4</span>
<span class="sd">                * t_1 : 5</span>
<span class="sd">                * t_2 : 6</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.UVFace&#39;&gt; instance at ...</span>
<span class="sd">                * t_0 : 6</span>
<span class="sd">                * t_1 : 5</span>
<span class="sd">                * t_2 : 7</span>
<span class="sd">            * vertex_colors :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 0</span>
<span class="sd">                * g : 1</span>
<span class="sd">                * b : 2</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 4</span>
<span class="sd">                * g : 5</span>
<span class="sd">                * b : 6</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 8</span>
<span class="sd">                * g : 9</span>
<span class="sd">                * b : 10</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 12</span>
<span class="sd">                * g : 13</span>
<span class="sd">                * b : 14</span>
<span class="sd">                4: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 50</span>
<span class="sd">                * g : 51</span>
<span class="sd">                * b : 52</span>
<span class="sd">                5: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 54</span>
<span class="sd">                * g : 55</span>
<span class="sd">                * b : 56</span>
<span class="sd">                6: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 58</span>
<span class="sd">                * g : 59</span>
<span class="sd">                * b : 60</span>
<span class="sd">                7: &lt;class &#39;pyffi.formats.cgf.IRGB&#39;&gt; instance at ...</span>
<span class="sd">                * r : 62</span>
<span class="sd">                * g : 63</span>
<span class="sd">                * b : 64</span>
<span class="sd">            * vertices_data : &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * normals_data : &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * uvs_data : &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * colors_data : &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * colors_2_data : None</span>
<span class="sd">            * indices_data : &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * tangents_data : &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * sh_coeffs_data : None</span>
<span class="sd">            * shape_deformation_data : None</span>
<span class="sd">            * bone_map_data : None</span>
<span class="sd">            * face_map_data : None</span>
<span class="sd">            * vert_mats_data : None</span>
<span class="sd">            * reserved_data :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: None</span>
<span class="sd">                1: None</span>
<span class="sd">                2: None</span>
<span class="sd">                3: None</span>
<span class="sd">            * physics_data :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: None</span>
<span class="sd">                1: None</span>
<span class="sd">                2: None</span>
<span class="sd">                3: None</span>
<span class="sd">            * min_bound : [  0.000  0.000  0.000 ]</span>
<span class="sd">            * max_bound : [  1.000  1.000  1.000 ]</span>
<span class="sd">            * reserved_3 :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: 0</span>
<span class="sd">                1: 0</span>
<span class="sd">                2: 0</span>
<span class="sd">                3: 0</span>
<span class="sd">                4: 0</span>
<span class="sd">                5: 0</span>
<span class="sd">                6: 0</span>
<span class="sd">                7: 0</span>
<span class="sd">                8: 0</span>
<span class="sd">                9: 0</span>
<span class="sd">                10: 0</span>
<span class="sd">                11: 0</span>
<span class="sd">                12: 0</span>
<span class="sd">                13: 0</span>
<span class="sd">                14: 0</span>
<span class="sd">                15: 0</span>
<span class="sd">                16: 0</span>
<span class="sd">                etc...</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.mesh_subsets) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.MeshSubsetsChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags :</span>
<span class="sd">                &lt;class &#39;pyffi.formats.cgf.MeshSubsetsFlags&#39;&gt; instance at ...</span>
<span class="sd">                * sh_has_decompr_mat : 0</span>
<span class="sd">                * bone_indices : 0</span>
<span class="sd">            * num_mesh_subsets : 2</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * reserved_3 : 0</span>
<span class="sd">            * mesh_subsets :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.MeshSubset&#39;&gt; instance at ...</span>
<span class="sd">                * first_index : 0</span>
<span class="sd">                * num_indices : 6</span>
<span class="sd">                * first_vertex : 0</span>
<span class="sd">                * num_vertices : 4</span>
<span class="sd">                * mat_id : 2</span>
<span class="sd">                * radius : 0.7071067...</span>
<span class="sd">                * center : [  0.500  0.500  0.000 ]</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.MeshSubset&#39;&gt; instance at ...</span>
<span class="sd">                * first_index : 6</span>
<span class="sd">                * num_indices : 6</span>
<span class="sd">                * first_vertex : 4</span>
<span class="sd">                * num_vertices : 4</span>
<span class="sd">                * mat_id : 5</span>
<span class="sd">                * radius : 0.7071067...</span>
<span class="sd">                * center : [  0.500  0.500  1.000 ]</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.vertices_data) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags : 0</span>
<span class="sd">            * data_stream_type : VERTICES</span>
<span class="sd">            * num_elements : 8</span>
<span class="sd">            * bytes_per_element : 12</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * vertices :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: [  0.000  0.000  0.000 ]</span>
<span class="sd">                1: [  0.000  1.000  0.000 ]</span>
<span class="sd">                2: [  1.000  0.000  0.000 ]</span>
<span class="sd">                3: [  1.000  1.000  0.000 ]</span>
<span class="sd">                4: [  0.000  0.000  1.000 ]</span>
<span class="sd">                5: [  0.000  1.000  1.000 ]</span>
<span class="sd">                6: [  1.000  0.000  1.000 ]</span>
<span class="sd">                7: [  1.000  1.000  1.000 ]</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.normals_data) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags : 0</span>
<span class="sd">            * data_stream_type : NORMALS</span>
<span class="sd">            * num_elements : 8</span>
<span class="sd">            * bytes_per_element : 12</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * normals :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: [  0.000  0.000 -1.000 ]</span>
<span class="sd">                1: [  0.000  0.000 -1.000 ]</span>
<span class="sd">                2: [  0.000  0.000 -1.000 ]</span>
<span class="sd">                3: [  0.000  0.000 -1.000 ]</span>
<span class="sd">                4: [  0.000  0.000  1.000 ]</span>
<span class="sd">                5: [  0.000  0.000  1.000 ]</span>
<span class="sd">                6: [  0.000  0.000  1.000 ]</span>
<span class="sd">                7: [  0.000  0.000  1.000 ]</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.indices_data) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags : 0</span>
<span class="sd">            * data_stream_type : INDICES</span>
<span class="sd">            * num_elements : 12</span>
<span class="sd">            * bytes_per_element : 2</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * indices :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: 0</span>
<span class="sd">                1: 1</span>
<span class="sd">                2: 2</span>
<span class="sd">                3: 2</span>
<span class="sd">                4: 1</span>
<span class="sd">                5: 3</span>
<span class="sd">                6: 4</span>
<span class="sd">                7: 5</span>
<span class="sd">                8: 6</span>
<span class="sd">                9: 6</span>
<span class="sd">                10: 5</span>
<span class="sd">                11: 7</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.uvs_data) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags : 0</span>
<span class="sd">            * data_stream_type : UVS</span>
<span class="sd">            * num_elements : 8</span>
<span class="sd">            * bytes_per_element : 8</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * uvs :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                4: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                5: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 0.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">                6: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 1.0</span>
<span class="sd">                7: &lt;class &#39;pyffi.formats.cgf.UV&#39;&gt; instance at ...</span>
<span class="sd">                * u : 1.0</span>
<span class="sd">                * v : 0.0</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.tangents_data) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags : 0</span>
<span class="sd">            * data_stream_type : TANGENTS</span>
<span class="sd">            * num_elements : 8</span>
<span class="sd">            * bytes_per_element : 16</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * tangents :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                0, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                1, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                1, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                2, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                2, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                3, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                3, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                4, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                4, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                5, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                5, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                6, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                6, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                7, 0: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 32767</span>
<span class="sd">                * y : 0</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">                7, 1: &lt;class &#39;pyffi.formats.cgf.Tangent&#39;&gt; instance at ...</span>
<span class="sd">                * x : 0</span>
<span class="sd">                * y : -32767</span>
<span class="sd">                * z : 0</span>
<span class="sd">                * w : 32767</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(chunk.colors_data) # doctest: +ELLIPSIS</span>
<span class="sd">            &lt;class &#39;pyffi.formats.cgf.DataStreamChunk&#39;&gt; instance at ...</span>
<span class="sd">            * flags : 0</span>
<span class="sd">            * data_stream_type : COLORS</span>
<span class="sd">            * num_elements : 8</span>
<span class="sd">            * bytes_per_element : 4</span>
<span class="sd">            * reserved_1 : 0</span>
<span class="sd">            * reserved_2 : 0</span>
<span class="sd">            * rgba_colors :</span>
<span class="sd">                &lt;class &#39;pyffi.object_models.xml.array.Array&#39;&gt; instance at ...</span>
<span class="sd">                0: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 0</span>
<span class="sd">                * g : 1</span>
<span class="sd">                * b : 2</span>
<span class="sd">                * a : 3</span>
<span class="sd">                1: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 4</span>
<span class="sd">                * g : 5</span>
<span class="sd">                * b : 6</span>
<span class="sd">                * a : 7</span>
<span class="sd">                2: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 8</span>
<span class="sd">                * g : 9</span>
<span class="sd">                * b : 10</span>
<span class="sd">                * a : 11</span>
<span class="sd">                3: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 12</span>
<span class="sd">                * g : 13</span>
<span class="sd">                * b : 14</span>
<span class="sd">                * a : 15</span>
<span class="sd">                4: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 50</span>
<span class="sd">                * g : 51</span>
<span class="sd">                * b : 52</span>
<span class="sd">                * a : 53</span>
<span class="sd">                5: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 54</span>
<span class="sd">                * g : 55</span>
<span class="sd">                * b : 56</span>
<span class="sd">                * a : 57</span>
<span class="sd">                6: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 58</span>
<span class="sd">                * g : 59</span>
<span class="sd">                * b : 60</span>
<span class="sd">                * a : 61</span>
<span class="sd">                7: &lt;class &#39;pyffi.formats.cgf.IRGBA&#39;&gt; instance at ...</span>
<span class="sd">                * r : 62</span>
<span class="sd">                * g : 63</span>
<span class="sd">                * b : 64</span>
<span class="sd">                * a : 65</span>
<span class="sd">            &lt;BLANKLINE&gt;</span>

<span class="sd">            :param verticeslist: A list of lists of vertices (one list per material).</span>
<span class="sd">            :param normalslist: A list of lists of normals (one list per material).</span>
<span class="sd">            :param triangleslist: A list of lists of triangles (one list per material).</span>
<span class="sd">            :param matlist: A list of material indices. Optional.</span>
<span class="sd">            :param uvslist: A list of lists of uvs (one list per material). Optional.</span>
<span class="sd">            :param colorslist: A list of lists of RGBA colors (one list per material).</span>
<span class="sd">                Optional. Each color is a tuple (r, g, b, a) with each component an</span>
<span class="sd">                integer between 0 and 255.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># argument sanity checking</span>
            <span class="c1"># check length of lists</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalslist</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;normalslist must have same length as verticeslist&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangleslist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalslist</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;triangleslist must have same length as verticeslist&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matlist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matlist</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;matlist must have same length as verticeslist&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uvslist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uvslist</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;uvslist must have same length as verticeslist&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">colorslist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colorslist</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;colorslist must have same length as verticeslist&quot;</span><span class="p">)</span>

            <span class="c1"># check length of lists in lists</span>
            <span class="k">for</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">,</span> <span class="n">normalslist</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">normals</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vertex and normal lists must have same length&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uvslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">uvs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">,</span> <span class="n">uvslist</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uvs</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vertex and uv lists must have same length&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">colorslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">colors</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">,</span> <span class="n">colorslist</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vertex and color lists must have same length&quot;</span><span class="p">)</span>

            <span class="c1"># get total number of vertices</span>
            <span class="n">numvertices</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertices</span> <span class="ow">in</span> <span class="n">verticeslist</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numvertices</span> <span class="o">&gt;</span> <span class="mi">65535</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot store geometry: too many vertices (</span><span class="si">%i</span><span class="s2"> and maximum is 65535)&quot;</span> <span class="o">%</span> <span class="n">numvertices</span><span class="p">)</span>
            <span class="n">numtriangles</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">triangles</span><span class="p">)</span> <span class="k">for</span> <span class="n">triangles</span> <span class="ow">in</span> <span class="n">triangleslist</span><span class="p">)</span>

            <span class="c1"># Far Cry data preparation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span> <span class="o">=</span> <span class="n">numvertices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_faces</span> <span class="o">=</span> <span class="n">numtriangles</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uvslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_uvs</span> <span class="o">=</span> <span class="n">numvertices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uvs</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uv_faces</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">colorslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_vertex_colors</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vertex_colors</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="c1"># Crysis data preparation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_indices</span> <span class="o">=</span> <span class="n">numtriangles</span> <span class="o">*</span> <span class="mi">3</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">VERTICES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="n">numvertices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">NORMALS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="n">numvertices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">normals</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">INDICES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="n">numtriangles</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">uvslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># uvs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">UVS</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="n">numvertices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">uvs</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>
                <span class="c1"># have tangent space</span>
                <span class="n">has_tangentspace</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># no tangent space</span>
                <span class="n">has_tangentspace</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">colorslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># vertex colors</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">COLORS</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="n">numvertices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">rgba_colors</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">num_mesh_subsets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">verticeslist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">MeshSubsetsChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="o">.</span><span class="n">num_mesh_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_mesh_subsets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="c1"># set up default iterators</span>
            <span class="k">if</span> <span class="n">matlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">matlist</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uvslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">uvslist</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colorslist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">colorslist</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="c1"># now iterate over all materials</span>
            <span class="n">firstvertexindex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">firstindicesindex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">mat</span><span class="p">,</span> <span class="n">uvs</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">meshsubset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">verticeslist</span><span class="p">,</span> <span class="n">normalslist</span><span class="p">,</span>
                <span class="n">triangleslist</span><span class="p">,</span> <span class="n">matlist</span><span class="p">,</span>
                <span class="n">uvslist</span><span class="p">,</span> <span class="n">colorslist</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="p">):</span>

                <span class="c1"># set Crysis mesh subset info</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">first_index</span> <span class="o">=</span> <span class="n">firstindicesindex</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">num_indices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangles</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">first_vertex</span> <span class="o">=</span> <span class="n">firstvertexindex</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">num_vertices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">mat_id</span> <span class="o">=</span> <span class="n">mat</span>
                <span class="n">center</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">mathutils</span><span class="o">.</span><span class="n">getCenterRadius</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># set vertex coordinates and normals for Far Cry</span>
                <span class="k">for</span> <span class="n">cryvert</span><span class="p">,</span> <span class="n">vert</span><span class="p">,</span> <span class="n">norm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># set vertex coordinates and normals for Crysis</span>
                <span class="k">for</span> <span class="n">cryvert</span><span class="p">,</span> <span class="n">crynorm</span><span class="p">,</span> <span class="n">vert</span><span class="p">,</span> <span class="n">norm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">normals</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">):</span>
                    
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cryvert</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">crynorm</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">crynorm</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">crynorm</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">norm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># set Far Cry face info</span>
                <span class="k">for</span> <span class="n">cryface</span><span class="p">,</span> <span class="n">triangle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="n">triangles</span><span class="p">):</span>
                    <span class="n">cryface</span><span class="o">.</span><span class="n">v_0</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstvertexindex</span>
                    <span class="n">cryface</span><span class="o">.</span><span class="n">v_1</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstvertexindex</span>
                    <span class="n">cryface</span><span class="o">.</span><span class="n">v_2</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstvertexindex</span>
                    <span class="n">cryface</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">mat</span>

                <span class="c1"># set Crysis face info</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vertexindex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">triangles</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">indices_data</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">firstindicesindex</span><span class="p">]</span> \
                        <span class="o">=</span> <span class="n">vertexindex</span> <span class="o">+</span> <span class="n">firstvertexindex</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">uvs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># set Far Cry uv info</span>
                    <span class="k">for</span> <span class="n">cryuvface</span><span class="p">,</span> <span class="n">triangle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uv_faces</span><span class="p">,</span> <span class="n">triangles</span><span class="p">):</span>
                        <span class="n">cryuvface</span><span class="o">.</span><span class="n">t_0</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstvertexindex</span>
                        <span class="n">cryuvface</span><span class="o">.</span><span class="n">t_1</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstvertexindex</span>
                        <span class="n">cryuvface</span><span class="o">.</span><span class="n">t_2</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">firstvertexindex</span>
                    <span class="k">for</span> <span class="n">cryuv</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uvs</span><span class="p">,</span> <span class="n">uvs</span><span class="p">):</span>
                        <span class="n">cryuv</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">uv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">cryuv</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">uv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># set Crysis uv info</span>
                    <span class="k">for</span> <span class="n">cryuv</span><span class="p">,</span> <span class="n">uv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">uvs</span><span class="p">,</span> <span class="n">uvs</span><span class="p">):</span>
                        <span class="n">cryuv</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">uv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">cryuv</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">uv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># OpenGL fix</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># set Far Cry color info</span>
                    <span class="k">for</span> <span class="n">crycolor</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="c1"># note: Far Cry does not support alpha color channel</span>

                    <span class="c1"># set Crysis color info</span>
                    <span class="k">for</span> <span class="n">crycolor</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors_data</span><span class="o">.</span><span class="n">rgba_colors</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">crycolor</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="c1"># update index offsets</span>
                <span class="n">firstvertexindex</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
                <span class="n">firstindicesindex</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangles</span><span class="p">)</span>

            <span class="c1"># update tangent space</span>
            <span class="k">if</span> <span class="n">has_tangentspace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_tangent_space</span><span class="p">()</span>

            <span class="c1"># set global bounding box</span>
            <span class="n">minbound</span><span class="p">,</span> <span class="n">maxbound</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">mathutils</span><span class="o">.</span><span class="n">getBoundingBox</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">verticeslist</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">minbound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">minbound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_bound</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">minbound</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">maxbound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">maxbound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bound</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">maxbound</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">update_tangent_space</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Recalculate tangent space data.&quot;&quot;&quot;</span>
            <span class="c1"># set up tangent space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tangents_data</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamChunk</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tangents_data</span><span class="o">.</span><span class="n">data_stream_type</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">DataStreamType</span><span class="o">.</span><span class="n">TANGENTS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tangents_data</span><span class="o">.</span><span class="n">bytes_per_element</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tangents_data</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_vertices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tangents_data</span><span class="o">.</span><span class="n">tangents</span><span class="o">.</span><span class="n">update_size</span><span class="p">()</span>

            <span class="c1"># set Crysis tangents info</span>
            <span class="n">tangents</span><span class="p">,</span> <span class="n">binormals</span><span class="p">,</span> <span class="n">orientations</span> <span class="o">=</span> <span class="n">pyffi</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">tangentspace</span><span class="o">.</span><span class="n">getTangentSpace</span><span class="p">(</span>
                <span class="n">vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">vert</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">vert</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">vert</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_data</span><span class="o">.</span><span class="n">vertices</span><span class="p">),</span>
                <span class="n">normals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">norm</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">norm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">normals_data</span><span class="o">.</span><span class="n">normals</span><span class="p">),</span>
                <span class="n">uvs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">uv</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">uv</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">uv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvs_data</span><span class="o">.</span><span class="n">uvs</span><span class="p">),</span>
                <span class="n">triangles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_triangles</span><span class="p">()),</span>
                <span class="n">orientation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">crytangent</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="nb">bin</span><span class="p">,</span> <span class="n">orient</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tangents_data</span><span class="o">.</span><span class="n">tangents</span><span class="p">,</span>
                                                     <span class="n">tangents</span><span class="p">,</span> <span class="n">binormals</span><span class="p">,</span> <span class="n">orientations</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">orient</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tangent_w</span> <span class="o">=</span> <span class="mi">32767</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tangent_w</span> <span class="o">=</span> <span class="o">-</span><span class="mi">32767</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="n">tan</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="n">tan</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="n">tan</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">tangent_w</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="nb">bin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="nb">bin</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">32767</span> <span class="o">*</span> <span class="nb">bin</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">crytangent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">tangent_w</span>

    <span class="k">class</span> <span class="nc">MeshMorphTargetChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">morphvert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">morph_vertices</span><span class="p">:</span>
                <span class="n">morphvert</span><span class="o">.</span><span class="n">vertex_target</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">morphvert</span><span class="o">.</span><span class="n">vertex_target</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">morphvert</span><span class="o">.</span><span class="n">vertex_target</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>

        <span class="k">def</span> <span class="nf">get_global_node_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get the block parent (used for instance in the QSkope global view).&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>

        <span class="k">def</span> <span class="nf">get_global_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a name for the block.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span>

    <span class="k">class</span> <span class="nc">MeshSubsetsChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">meshsubset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_subsets</span><span class="p">:</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">radius</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
                <span class="n">meshsubset</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>

    <span class="k">class</span> <span class="nc">MtlChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_name_shader_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Extract name, shader, and script.&quot;&quot;&quot;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">shader_begin</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
            <span class="n">shader_end</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="n">script_begin</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">script_begin</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># must have exactly one script</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> malformed, has multiple &quot;&quot;/&quot;&quot;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
                <span class="n">mtlscript</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">script_begin</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mtlscript</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">shader_begin</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># if a shader was specified</span>
                <span class="n">mtl_end</span> <span class="o">=</span> <span class="n">shader_begin</span>
                <span class="c1"># must have exactly one shader</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># some names are buggy and have &quot;((&quot; instead of &quot;(&quot;</span>
                    <span class="c1"># like in jungle_camp_sleeping_barack</span>
                    <span class="c1"># here we handle that case</span>
                    <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="n">shader_begin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span> \
                       <span class="ow">and</span> <span class="n">name</span><span class="p">[</span><span class="n">shader_begin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">shader_begin</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> malformed, has multiple &quot;&quot;(&quot;&quot;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> malformed, has multiple &quot;&quot;)&quot;&quot;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
                <span class="c1"># shader name should non-empty</span>
                <span class="k">if</span> <span class="n">shader_begin</span> <span class="o">&gt;</span> <span class="n">shader_end</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> malformed, &quot;&quot;(&quot;&quot; comes after &quot;&quot;)&quot;&quot;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
                <span class="c1"># script must be immediately followed by the material</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">script_begin</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">shader_end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">script_begin</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> malformed, shader not followed by script&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>
                <span class="n">mtlname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">mtl_end</span><span class="p">]</span>
                <span class="n">mtlshader</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">shader_begin</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">shader_end</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">script_begin</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">mtlname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">script_begin</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mtlname</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:]</span>
                <span class="n">mtlshader</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="n">mtlname</span><span class="p">,</span> <span class="n">mtlshader</span><span class="p">,</span> <span class="n">mtlscript</span>

    <span class="k">class</span> <span class="nc">NodeChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_global_node_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get the block parent (used for instance in the QSkope global view).&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>

        <span class="k">def</span> <span class="nf">apply_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Apply scale factor on data.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">m_41</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">m_42</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">m_43</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">scale</span>

        <span class="k">def</span> <span class="nf">update_pos_rot_scl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Update position, rotation, and scale, from the transform.&quot;&quot;&quot;</span>
            <span class="n">scale</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">get_scale_quat_translation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">z</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">z</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">w</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scl</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scl</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scl</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">z</span>

    <span class="k">class</span> <span class="nc">SourceInfoChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_global_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a name for the block.&quot;&quot;&quot;</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">class</span> <span class="nc">TimingChunk</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">get_global_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Return a name for the block.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_range</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CgfFormat.Vector3"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3">[docs]</a>    <span class="k">class</span> <span class="nc">Vector3</span><span class="p">:</span>
<div class="viewcode-block" id="CgfFormat.Vector3.as_list"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3.as_list">[docs]</a>        <span class="k">def</span> <span class="nf">as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">]</span></div>

<div class="viewcode-block" id="CgfFormat.Vector3.as_tuple"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3.as_tuple">[docs]</a>        <span class="k">def</span> <span class="nf">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="CgfFormat.Vector3.norm"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3.norm">[docs]</a>        <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span></div>

<div class="viewcode-block" id="CgfFormat.Vector3.normalize"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3.normalize">[docs]</a>        <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">&lt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s1">&#39;cannot normalize vector </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">norm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">norm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="n">norm</span></div>

<div class="viewcode-block" id="CgfFormat.Vector3.get_copy"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3.get_copy">[docs]</a>        <span class="k">def</span> <span class="nf">get_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
            <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="k">return</span> <span class="n">v</span></div>

        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;[ </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> </span><span class="si">%6.3f</span><span class="s2"> ]&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">z</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix33</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_11</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_21</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_31</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_12</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_22</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_32</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_13</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_23</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">m_33</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Matrix44</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">get_matrix_33</span><span class="p">()</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">get_translation</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to multiply Vector3 with </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to multiply </span><span class="si">%s</span><span class="s2"> and Vector3&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">/</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to divide Vector3 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">z</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to add Vector3 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to add </span><span class="si">%s</span><span class="s2"> and Vector3&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">z</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to substract Vector3 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to substract </span><span class="si">%s</span><span class="s2"> and Vector3&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

        <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
            <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="c1"># cross product</span>
<div class="viewcode-block" id="CgfFormat.Vector3.crossproduct"><a class="viewcode-back" href="../../../pyffi/formats/cgf.html#pyffi.formats.cgf.CgfFormat.Vector3.crossproduct">[docs]</a>        <span class="k">def</span> <span class="nf">crossproduct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()</span>
                <span class="n">v</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">y</span>
                <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">z</span>
                <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">x</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to calculate crossproduct of Vector3 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span></div>

        <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">Vector3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;do not know how to compare Vector3 and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">x</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">CgfFormat</span><span class="o">.</span><span class="n">EPSILON</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PyFFI 2.2.4.dev4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyffi.formats.cgf</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2019, NifTools.
      Last updated on Jan 26, 2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>